{% extends 'common/dashboard_base.html' %}
{% load static %}

{% block title %}Create Booking{% endblock %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-4">Create New Booking</h2>
    <form id="create-booking-form" method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        <div class="row">
            <!-- Booking Model Fields -->
            <div class="col-md-6">
                <h5>Booking Details</h5>
                <div class="mb-3">
                    <label for="service_type" class="form-label">Service Type</label>
                    <select name="service_type" id="service_type" class="form-select" required>
                        <option value="">Select a Service</option>
                        {% for service in service_offerings %}
                        <option value="{{ service.id }}">{{ service.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-3">
                    <label for="booking_date" class="form-label">Booking Date</label>
                    <input type="date" name="booking_date" id="booking_date" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="start_time" class="form-label">Start Time</label>
                    <input type="time" name="start_time" id="start_time" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="end_time" class="form-label">End Time</label>
                    <input type="time" name="end_time" id="end_time" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="location_type" class="form-label">Location Type</label>
                    <select name="location_type" id="location_type" class="form-select" required>
                        <option value="business">Business Location</option>
                        <option value="onsite">On-site (Client Location)</option>
                        <option value="virtual">Virtual Meeting</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="location_details" class="form-label">Location Details</label>
                    <textarea name="location_details" id="location_details" class="form-control"></textarea>
                </div>
                <div class="mb-3">
                    <label for="notes" class="form-label">Notes</label>
                    <textarea name="notes" id="notes" class="form-control"></textarea>
                </div>
            </div>
            <!-- Custom Fields -->
            <div class="col-md-6">
                <h5>Client Information</h5>
                {% for field in custom_fields %}
                    <div class="mb-3">
                        <label for="custom_{{ field.slug }}" class="form-label">{{ field.name }}{% if field.required %} <span class="text-danger">*</span>{% endif %}</label>
                        {% if field.field_type == 'text' %}
                            <input type="text" name="custom_{{ field.slug }}" id="custom_{{ field.slug }}" class="form-control" {% if field.required %}required{% endif %} placeholder="{{ field.placeholder }}">
                        {% elif field.field_type == 'number' %}
                            <input type="number" name="custom_{{ field.slug }}" id="custom_{{ field.slug }}" class="form-control" {% if field.required %}required{% endif %} placeholder="{{ field.placeholder }}">
                        {% elif field.field_type == 'select' %}
                            <select name="custom_{{ field.slug }}" id="custom_{{ field.slug }}" class="form-select" {% if field.required %}required{% endif %}>
                                <option value="">Select an option</option>
                                {% for option in field.options %}
                                    <option value="{{ option }}">{{ option }}</option>
                                {% endfor %}
                            </select>
                        {% elif field.field_type == 'date' %}
                            <input type="date" name="custom_{{ field.slug }}" id="custom_{{ field.slug }}" class="form-control" {% if field.required %}required{% endif %}>
                        {% elif field.field_type == 'time' %}
                            <input type="time" name="custom_{{ field.slug }}" id="custom_{{ field.slug }}" class="form-control" {% if field.required %}required{% endif %}>
                        {% elif field.field_type == 'boolean' %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="true" name="custom_{{ field.slug }}" id="custom_{{ field.slug }}">
                                <label class="form-check-label" for="custom_{{ field.slug }}">Yes</label>
                            </div>
                        {% elif field.field_type == 'email' %}
                            <input type="email" name="custom_{{ field.slug }}" id="custom_{{ field.slug }}" class="form-control" {% if field.required %}required{% endif %} placeholder="{{ field.placeholder }}">
                        {% elif field.field_type == 'phone' %}
                            <input type="tel" name="custom_{{ field.slug }}" id="custom_{{ field.slug }}" class="form-control" {% if field.required %}required{% endif %} placeholder="{{ field.placeholder }}">
                        {% elif field.field_type == 'textarea' %}
                            <textarea name="custom_{{ field.slug }}" id="custom_{{ field.slug }}" class="form-control" {% if field.required %}required{% endif %} placeholder="{{ field.placeholder }}"></textarea>
                        {% else %}
                            <input type="text" name="custom_{{ field.slug }}" id="custom_{{ field.slug }}" class="form-control" {% if field.required %}required{% endif %} placeholder="{{ field.placeholder }}">
                        {% endif %}
                        {% if field.help_text %}
                        <small class="form-text text-muted">{{ field.help_text }}</small>
                        {% endif %}
                    </div>
                {% empty %}
                    <div class="alert alert-info">No custom fields configured for this business.</div>
                {% endfor %}
            </div>
        </div>
        <div class="mt-4">
            <button type="submit" class="btn btn-primary">Create Booking</button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/bookings-create-booking.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/bookings-create-booking.js' %}"></script>
{% endblock %}
